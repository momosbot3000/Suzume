#include <EEPROM.h>

//Notes[n][3]
  //1    = 32
  //1/2  = 16
  //1/4  = 8
  //1/8  = 4
  //1/16 = 2
  //1/32 = 1
//Notes[n][1]
  //C  = 1  do
  //C# = 2  do#
  //D  = 3  re
  //D#  re#
  //E  = 5  mi
  //F  = 6  fa
  //F# = 7  fa#
  //G  = 8  sol
  //G# = 9  sol#
  //A  = 10 la
  //A# = 11 la#
  //B  = 12 si

   byte Notes[][2] = {
    //Intro - Vocals
    {0 , 4}, //1
    {3 , 4}, {10, 4}, {10, 4}, //2
    {6 , 4}, {5 , 4}, {3 , 4}, {1 , 4}, {10, 3}, {1 , 4}, //3
    {3 , 4}, {5 , 4}, {6 , 4}, {8 , 4}, {6 , 4}, {5 , 4}, //4
    {1 , 4}, {0 , 4}, {0 , 4}, //5
    {3 , 4}, {10, 4}, {10, 4}, //6
    {6 , 4}, {5 , 4}, {3 , 4}, {1 , 4}, {10, 3}, {1 , 4}, //7
    {3 , 4}, {5 , 4}, {6 , 4}, {8 , 4}, {6 , 4}, {5 , 4}, //8
    {3 , 4}, {0 , 4}, {0 , 4}, //9
    {3 , 4}, {10, 4}, {10, 4}, //10
    {6 , 4}, {5 , 4}, {3 , 4}, {1 , 4}, {10, 3}, {1 , 4}, //11
    {3 , 4}, {5 , 4}, {6 , 4}, {8 , 4}, {6 , 4}, {5 , 4}, //12
    {1 , 4}, {0 , 4}, {0 , 4}, //13
    {3 , 4}, {10, 4}, {10, 4}, //14
    {6 , 4}, {5 , 4}, {3 , 4}, {1 , 4}, {10, 3}, {1 , 4}, //14
    {3 , 4}, {5 , 4}, {6 , 4}, {8 , 4}, {6 , 4}, {5 , 4}, //15
    {3 , 4}, {0 , 4}, //16
    //Instrumental - Piano
    {10, 5}, {1 , 6}, {10, 5}, //17
    {8 , 5}, {10, 5}, //18
    {6 , 5}, {8 , 5}, //19
    {5 , 5}, {1 , 5}, //20
    {10, 5}, {1 , 6}, {10, 5}, //21
    {8 , 5}, {10, 5}, //22
    {6 , 5}, {8 , 5}, //23
    {5 , 5}, {1 , 5}, //24
    //Verse - Vocal
    {3 , 4}, {10, 4}, {10, 4}, //25
    {6 , 4}, {5 , 4}, {3 , 4}, {1 , 4}, {10, 3}, {1 , 4}, //26
    {3 , 4}, {5 , 4}, {6 , 4}, {8 , 4}, {6 , 4}, {5 , 4}, //27
    {1 , 4}, {0 , 4}, {0 , 4}, //28
    {3 , 4}, {10, 4}, {10, 4}, //29
    {6 , 4}, {5 , 4}, {3 , 4}, {1 , 4}, {10, 3}, {1 , 4}, //30
    {3 , 4}, {5 , 4}, {6 , 4}, {8 , 4}, {6 , 4}, {5 , 4}, //31
    {3 , 4}, {0 , 4}, {0 , 4}, //32
    {3 , 4}, {10, 4}, {10, 4}, //33
    {6 , 4}, {5 , 4}, {3 , 4}, {1 , 4}, {10, 3}, {1 , 4}, //34
    {3 , 4}, {5 , 4}, {6 , 4}, {8 , 4}, {6 , 4}, {5 , 4}, //35
    {1 , 4}, {0 , 4}, {0 , 4}, //36
    {3 , 4}, {10, 4}, {10, 4}, //37
    {6 , 4}, {5 , 4}, {3 , 4}, {1 , 4}, {10, 3}, {1 , 4}, //38
    {3 , 4}, {5 , 4}, {6 , 4}, {8 , 4}, {6 , 4}, {5 , 4}, //39
    {3 , 4}, {0 , 4}, {6 , 4}, {8 , 4}, //40
    //Pre-Chorus - Vocals
    {10, 4}, {8 , 4}, {6 , 4}, {8 , 4}, {10, 4}, //41
    {0 , 4}, {6 , 4}, {8 , 4}, //42
    {10, 4}, {8 , 4}, {6 , 4}, {8 , 4}, {10, 4}, //43
    {0 , 4}, {6 , 4}, {8 , 4}, //44
    {10, 4}, {8 , 4}, {6 , 4}, {8 , 4}, {10, 4}, //45
    {0 , 4}, {6 , 4}, {8 , 4}, //46
    {10, 4}, {8 , 4}, {6 , 4}, {8 , 4}, {10, 4}, //47
    //48
    //Chorus I - Vocals
    {3 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {10, 4}, {10, 4}, {10, 4}, //49
    {10, 4}, {8 , 4}, {8 , 4}, {8 , 4}, {8 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, //50    
    {10, 4}, {0 , 4}, //51
    {6 , 4}, {8 , 4}, {10, 4}, {8 , 4}, {6 , 4}, {6 , 4}, //52
    {3 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {10, 4}, {10, 4}, {10, 4}, //53
    {10, 4}, {8 , 4}, {8 , 4}, {8 , 4}, {8 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, //54    
    {10, 4}, {0 , 4}, //55
    {6 , 4}, {8 , 4}, {10, 4}, {8 , 4}, {6 , 4}, {6 , 4}, {1 , 4}, //56
    {3 , 4}, {6 , 4}, {5 , 4}, {1 , 4}, {3 , 4}, //57
    {0 , 4}, {1 , 4}, {3 , 4}, {1 , 4}, //58
    {3 , 4}, {6 , 4}, {5 , 4}, {1 , 4}, {3 , 4}, //59
    //60
    {3 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {10, 4}, {10, 4}, {10, 4}, //61
    {10, 4}, {8 , 4}, {8 , 4}, {8 , 4}, {8 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, //62    
    {10, 4}, {0 , 4}, {6 , 4}, //63
    {6 , 4}, {8 , 4}, {10, 4}, {8 , 4}, {6 , 4}, {6 , 4}, //64
    {3 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {10, 4}, {10, 4}, {10, 4}, //65
    {10, 4}, {8 , 4}, {8 , 4}, {8 , 4}, {8 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, //66   
    {10, 4}, {0 , 4}, //67
    {6 , 4}, {8 , 4}, {10, 4}, {8 , 4}, {6 , 4}, {6 , 4}, {1 , 4}, //68
    {3 , 4}, {6 , 4}, {5 , 4}, {1 , 4}, {3 , 4}, //69
    {0 , 4}, {1 , 4}, //70
    {3 , 4}, {6 , 4}, {5 , 4}, {1 , 4}, {3 , 4}, //71
    {0 , 4}, {1 , 4}, //72
    {3 , 4}, {6 , 4}, {5 , 4}, {1 , 4}, {3 , 4}, //73
    {6 , 4}, {6 , 4}, {8 , 4}, {8 , 4}, //74
    {0 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, //75
    {10, 4}, {8 , 4}, {8 , 4}, {6 , 4}, //76
    //Instrumental II - Saxophone 
    {6 , 5}, {10, 5}, {6 , 5}, {5 , 5}, //77
    {3 , 5}, {5 , 5}, //78
    {6 , 5}, {0 , 5}, //79
    {0 , 5}, {1 , 5}, //80
    {6 , 5}, {10, 5}, {6 , 5}, {5 , 5}, //81
    {3 , 5}, {5 , 5}, //82
    {3 , 5}, //83
    {6 , 4}, {8 , 4}, //84
    //Bridge - Vocals
    {10, 4}, {8 , 4}, {8 , 4}, {6 , 4}, {3 , 4}, //85
    {0 , 4}, {3 , 4}, {1 , 4}, //86
    {3 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, {10, 4}, //87
    {0 , 4}, {6 , 4}, {8 , 4}, //88
    {10, 4}, {8 , 4}, {8 , 4}, {6 , 4}, {3 , 4}, //89
    {0 , 4}, {3 , 4}, {1 , 4}, //90
    {3 , 4}, {6 , 4}, {6 , 4}, {6 , 4}, {10, 4}, {8 , 4}, //91
    {0 , 4}, {10, 4}, {8 , 4}, //92
    {10, 4}, {10, 4}, {3 , 5}, {1 , 5}, //93
    {0 , 4}, {6 , 4}, {3 , 4}, //94
    {6 , 4}, {6 , 4}, {8 , 4}, {10, 4}, //95
    {0 , 4}, {3 , 4}, {1 , 4}, //96
    {3 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, {10, 4}, //97
    {0 , 4}, {10, 4}, {8 , 4}, {6 , 4}, {5 , 4}, //98
    {3 , 4}, {3 , 4}, {1 , 4}, {3 , 4}, //99
    {0 , 4}, {6 , 4}, {8 , 4}, //100
    {10, 4}, {10, 4}, {3 , 5}, {1 , 5}, //101
    {0 , 4}, {6 , 4}, {3 , 4}, //102
    {6 , 4}, {6 , 4}, {8 , 4}, {10, 4}, //103
    {0 , 4}, {3 , 4}, {1 , 4}, //104
    {3 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, {10, 4}, //105
    {0 , 4}, {10, 4}, {8 , 4}, {6 , 4}, {5 , 4}, //106
    {3 , 4}, {3 , 4}, {1 , 4}, {1 , 4}, {3 , 4}, //107
    {0 , 4}, {10, 4}, //108
    {8 , 4}, {6 , 4}, {5 , 4}, {3 , 4}, //109
    {0 , 4}, //110
    //Instrumental III - Guitar / Piano
    {10, 5}, {3 , 5}, {6 , 5}, {10, 5}, {8 , 5}, {3 , 5}, {5 , 5}, {1, 5}, //111
    {3 , 5}, {0 , 5}, {1 , 5}, {3 , 5}, {6 , 5}, {8 , 5}, //112
    {10, 5}, {3 , 5}, {6 , 5}, {10, 5}, {8 , 5}, {3 , 5}, {5 , 5}, {1, 5}, //113
    {3 , 5}, {0 , 5}, {1 , 5}, {3 , 5}, {6 , 5}, {8 , 5}, //114
    {10, 5}, {3 , 5}, {6 , 5}, {10, 5}, {8 , 5}, {3 , 5}, {5 , 5}, {1, 5}, //115
    {3 , 5}, {0 , 5}, {1 , 5}, {3 , 5}, {6 , 5}, {8 , 5}, //116
    {10, 5}, {3 , 5}, {6 , 5}, {10, 5}, {8 , 5}, {3 , 5}, {5 , 5}, {1 , 5}, //117
    {3 , 5}, {0 , 5}, {1 , 5}, {5 , 4}, {6 , 4}, {8 , 4}, {10, 4}, {12, 4}, {1 , 5}, {3 , 5}, {5 , 5}, {6 , 5}, {8 , 5}, {10, 5}, {12, 5},  //118
    {1 , 6}, {0 , 6}, //119
    //Chorus II - Vocals
    {3 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {10, 4}, {10, 4}, {10, 4}, //120
    {1 , 4}, {8 , 4}, {8 , 4}, {8 , 4}, {8 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, //121
    {10, 4}, {0 , 4}, //122
    {6 , 4}, {8 , 4}, {10, 4}, {8 , 4}, {6 , 4}, {6 , 4}, //123
    {3 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {10, 4}, {10, 4}, {10, 4}, //124
    {1 , 4}, {8 , 4}, {8 , 4}, {8 , 4}, {8 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, //125
    {10, 4}, {0 , 4}, //126
    {6 , 4}, {8 , 4}, {10, 4}, {8 , 4}, {6 , 4}, {6 , 4}, {1 , 4}, //127
    {3 , 4}, {6 , 4}, {5 , 4}, {1 , 4}, {3 , 4}, //128
    {0 , 4}, {1 , 4}, {3 , 4}, {1 , 4}, //129
    {3 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, {10, 4}, //130
    //131
    {3 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {10, 4}, {10, 4}, {10, 4}, //132
    {1 , 4}, {8 , 4}, {8 , 4}, {8 , 4}, {8 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, //133
    {10, 4}, {0 , 4}, //134
    {6 , 4}, {8 , 4}, {10, 4}, {8 , 4}, {6 , 4}, {6 , 4}, //135
    {3 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {1 , 5}, {10, 4}, {10, 4}, {10, 4}, //136
    {1 , 4}, {8 , 4}, {8 , 4}, {8 , 4}, {8 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, //137
    {10, 4}, {0 , 4}, //138
    {6 , 4}, {8 , 4}, {10, 4}, {8 , 4}, {6 , 4}, {6 , 4}, {1 , 4}, //139
    {3 , 4}, {6 , 4}, {5 , 4}, {1 , 4}, {3 , 4}, //140
    {0 , 4}, {1 , 4}, //141
    {3 , 4}, {6 , 4}, {6 , 4}, {8 , 4}, {10, 4}, //142
    {0 , 4}, {1 , 4}, //143
    {3 , 4}, {6 , 4}, {5 , 4}, {1 , 4}, {3 , 4}, //144
    {6 , 4}, {6 , 4}, {8 , 4}, {8 , 4}, //145
    {0 , 4}, {6 , 4}, {6 , 4}, //146
    {10, 4}, {8 , 4}, {8 , 4}, {6 , 4}, //147
    //Ending - Vocals / Saxophone
    {6 , 4}, {10, 5}, {6 , 5}, //148
    {5 , 5}, {1 , 5}, //149
    {6 , 5}, //150
  };

void setup() {
  
  Serial.begin(9600);
  pinMode(11, OUTPUT);
  int SizeNotes = (sizeof(Notes) / sizeof(*Notes));
  Serial.println(SizeNotes);
  Play(Notes, SizeNotes, 152, 11);
}


void loop() {
  
}

float Hz(int note, int octave){

  if(note <= 0 || note > 12 || octave < 0){
    return 0.0;
  }
  else{
    if(octave >= 0 && note > 0 && note <= 12){
      float hz = 440 * pow(1.05946309436, 12 * (octave - 4) + note - 10);
      return hz;
    }
  }
}


void Play(byte Notes[][2], int SizeNotes, uint8_t bpm, uint8_t buzzer){
  
  float start = millis();
  float keep = start;
  float beatDuration = 60000 / bpm;

  for (int i = 0; i < SizeNotes; i++) {
    
    float noteDuration = (EEPROM.read(i) * beatDuration) / 8; 
    float Frecuency = Hz(Notes[i][0], Notes[i][1]);

    if(Frecuency > 0){    
      while(millis() <= keep + (noteDuration * 0.9)){
        tone(buzzer, Frecuency);
      }
      while(millis() >= keep + (noteDuration * 0.9) && millis() <= keep + noteDuration){    
        noTone(buzzer);
      }
    }
    else{
      while(millis() <= keep + noteDuration){
        noTone(buzzer);
      }
    }
    keep += noteDuration;
    Serial.println(i);
  }
}